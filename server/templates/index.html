<!DOCTYPE html>
<html>
  <head>
    <title>Start/Join a Party</title>
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/index.css') }}">
  </head>
<body>
  <span class="slam">Spotify</span>
  <div id='main_party_txt' class="slam slam_delayed">Party</div>
  <div class="button_div" id="create_party_div">
    <button type="button" id="create_party_btn" class="create_join_btn" onclick="createPartyBtn()">
      <span class="create_join_span">Create Party</span>
    </button>
    <input type="text" placeholder="Enter Party Name" id="partyNametxt" class="party_name_code_text">
  </div>
  <div class="button_div" id="join_party_div">
    <button type ="button" id="join_party_btn" class="create_join_btn" onclick="joinParty()">
      <span class="create_join_span">Join Party</span>
    </button>
    <input type="text" placeholder="Enter Party Code" id="partyCodetxt" class="party_name_code_text">
  </div>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
  <script type="text/javascript">
    function createPartyBtn() {
      var partyNametxt = document.getElementById("partyNametxt");
      var partyNametxtstyle = window.getComputedStyle(partyNametxt);
      if (partyNametxtstyle.getPropertyValue("display") != "none") {
        if (/^[\w\-\s]+$/.test(partyNametxt.value)) {
          createParty(partyNametxt.value);
        } else {
          var body = document.getElementsByTagName("BODY")[0];
          var already_present_warning = document.querySelector('.warning_msg');
          if (already_present_warning != null) {
            body.removeChild(already_present_warning);
          }
          partyNametxt.classList.add("shake");
          partyNametxt.addEventListener("animationend", (e) => {
          partyNametxt.classList.remove("shake");
          });
          var warning_message_div = document.createElement("div");
          warning_message_div.innerHTML = "<p>Party name can only contain letters, numbers, spaces, hyphens and underscores.</p>";
          warning_message_div.className = "warning_msg";
          warning_message_div.style.color = "#ffae42";
          warning_message_div.style.textAlign = "center";
          warning_message_div.style.marginTop = "40px";
          body.appendChild(warning_message_div);
          var warning_message_p = warning_message_div.firstChild;
          warning_message_p.style.fontFamily = "proxima-nova, sans-serif";
        }
      } else {
        var party_create_btn = document.getElementById("create_party_btn");
        partyNametxt.style.display = "block";
        party_create_btn.style.webkitAnimationPlayState = "running";
        partyNametxt.style.webkitAnimationPlayState = "running";
        document.getElementById("partyNametxt").focus();
      }
    }
    function createParty(party_name) {
      request = {
        "partyid":"",
        "rtype":"createRoom",
        "data": party_name
      };
      sendMessage(JSON.stringify(request));
    }
    function joinParty() {
      code = document.getElementById("partyCodetxt").value;

    }
    function sendMessage(msg) {
        console.log("Sending: " + msg);
        socket.send(msg);
    }

    var socket = io.connect('http://' + document.domain + ':' + location.port);
    socket.on('connect', function() {
        socket.emit('my event', {data: 'I\'m connected!'});
    });
    socket.on('message', function(msg) {
      message = JSON.parse(msg);
      if (message["rtype"] == "auth") {
        window.location = message["data"];
      } else if (message["rtype"] == "roomCode") {
        window.location = "/main.html?id=" + message["data"];
      }
    });
  </script>
 <script src="index.js"></script>
</body>
</html>
